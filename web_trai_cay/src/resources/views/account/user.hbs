<div class="flex-container"
    style="display: flex;flex-direction: row;font-size: 30px;gap:50px;text-align: center;padding: 0px 50px 0 50px; ">
    <div class="flex-item-left" style="padding: 10px; flex: 70%;">
        <div style="display: flex;justify-content:space-between">
            <h1 style="text-align: left;font-weight:bold ;">ƒê∆°n h√†ng</h1>
            <div style="display: flex; align-items: center;margin-right:0px;margin-bottom:6px">
                <form class="dropdown" id="sortForm" method="GET" action="">
                    <button id="sortDropdown"
                        style="width:100px;background-color: #ffffff; border: 1px solid #000000; border-radius: px; color: #151515; padding: 10px; font-family: 'Arial', sans-serif; font-size: 16px; font-weight: bold; cursor: pointer; "
                        type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        L·ªçc
                    </button>
                    <input type="hidden" name="sort" id="sortValue" value="">
                    <ul class="dropdown-menu" name="sort"
                        style="position: absolute; left: 50%; transform: translate(-50%, 0); text-align: center; margin-top: 5px; padding: 0; border-radius: 5px; background-color: #ffffff; border: 1px solid #ddd; z-index: 1000; width: auto;">
                        <li style="list-style: none;">
                            <button class="dropdown-item" value=""
                                style="padding: 10px 15px; display: block; text-decoration: none; color: #333;">
                                T·∫•t c·∫£
                            </button>
                        </li>
                        <li style="list-style: none;">
                            <button class="dropdown-item" value="dang-xu-ly"
                                style="padding: 10px 15px; display: block; text-decoration: none; color: #333;">
                                ƒêang x·ª≠ l√Ω
                            </button>
                        </li>
                        <li style="list-style: none;">
                            <button class="dropdown-item" value="dang-giao"
                                style="padding: 10px 15px; display: block; text-decoration: none; color: #333;">
                                ƒêang giao
                            </button>
                        </li>
                        <li style="list-style: none;">
                            <button class="dropdown-item" value="da-giao"
                                style="padding: 10px 15px; display: block; text-decoration: none; color: #333;">
                                ƒê√£ giao
                            </button>
                        </li>
                        <li style="list-style: none;">
                            <button class="dropdown-item" value="da-huy"
                                style="padding: 10px 15px; display: block; text-decoration: none; color: #333;">
                                ƒê√£ h·ªßy
                            </button>
                        </li>
                    </ul>
                </form>
            </div>
        </div>
        <p id="empty" style="text-align: left;margin-top:10px; font-size: 20px;display:none">ƒê∆°n h√†ng r·ªóng!</p>

        <div id="order-item-div">

        </div>

    </div>


    <div class="flex-item-right" style="padding: 10px;flex: 30%;">
        <div
            style="background: #fff; padding: 0px;padding-top:0; border-radius: 0 15px 15px 0; width: 100%; box-shadow: none;">
            <form method="POST" action="/account/user/info" id="info-form">
                <h2 style="text-align: left; margin-bottom: 20px;margin-top: 12px ;font-weight:bold ;font-size:22px">
                    Th√¥ng tin c√° nh√¢n
                </h2>
                <div style="margin-bottom: 15px; display: flex">
                    <input type="text" id="hovaten" name="hovaten" placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa b·∫°n" value=""
                        style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px;">
                </div>
                <input type="email" id="email" name="email" placeholder="Nh·∫≠p email c·ªßa b·∫°n" value=""
                    style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px;margin-bottom: 15px;">
                <input type="text" id="sdt" name="sdt" placeholder="Nh·∫≠p sdt c·ªßa b·∫°n" value=""
                    style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px;margin-bottom: 15px;">
                <div style="display: flex;  justify-content: space-between;gap:10px">
                    <button class="button-27" type="submit" id="info-button"
                        style="background-color: #000; color: #fff;  width: 100%; display: flex; align-items: center; justify-content: center; border: none;"
                        role="button">
                        L∆∞u
                    </button>
                </div>
            </form>

            <button class="button-27"
                style="margin-top:10px;background-color: #ff5722; color: #fff; width: 100%; display: flex; align-items: center; justify-content: center; border: none;"
                role="button" data-bs-toggle="modal" data-bs-target="#changepasswordModal">
                ƒê·ªïi m·∫≠t kh·∫©u
            </button>
            <div class="modal fade" id="changepasswordModal" tabindex="-1" aria-labelledby="changepasswordModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content"
                        style="position:relative; display: flex; align-items: center; justify-content: center;">
                        <span id="closex"
                            style="position:absolute; right:10px; top:5px; font-size: 30px; cursor: pointer; transition: color 0.3s;">
                            &times;
                        </span>
                        <form method="post" id="pw-form"
                            style="background: #fff; padding: 40px; border-radius: 20px; width: 100%; height: auto; display: flex; flex-direction: column; justify-content: center;">
                            <h1 style="margin-bottom: 20px; text-align: center; color: #333;">ƒê·ªïi m·∫≠t kh·∫©u</h1>

                            <div style="margin-bottom: 10px;">
                                <label for="oldPassword"
                                    style="display: block; margin-bottom: 5px; color: #555; font-size: 18px; text-align: left;">
                                    M·∫≠t kh·∫©u c≈©
                                </label>
                                <input type="password" id="oldPassword" name="oldPassword"
                                    style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px;"
                                    required>
                            </div>

                            <div style="margin-bottom: 10px;">
                                <label for="newPassword"
                                    style="display: block; margin-bottom: 5px; color: #555; font-size: 18px; text-align: left;">
                                    M·∫≠t kh·∫©u m·ªõi
                                </label>
                                <input type="password" id="newPassword" name="newPassword"
                                    style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px;"
                                    required>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label for="confirmPassword"
                                    style="display: block; margin-bottom: 5px; color: #555; font-size: 18px; text-align: left;">
                                    X√°c nh·∫≠n m·∫≠t kh·∫©u
                                </label>
                                <input type="password" id="confirmPassword" name="confirmPassword"
                                    style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px;"
                                    required>
                            </div>

                            <button type="submit" class="button-27" id="password-btn"
                                style="margin-top: 15px; background-color: #ff5722; color: #fff; padding: 14px; border-radius: 10px; border: none; cursor: pointer; width: 100%; font-size: 16px;">
                                L∆∞u thay ƒë·ªïi
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <form id="huy-form" method="POST" action="/account/user/order" style="display:none">
            <input id="huy-id" type="hidden" name="id" value="">
        </form>
        <h2 style="text-align: left; margin-top: 20px; cursor: pointer;  position: relative; font-weight: bold; font-size: 22px; margin-bottom: 20px;"
            onclick="toggleInputs()">
            ƒê·ªãa ch·ªâ giao h√†ng
            <span id="toggleIcon" style="position: absolute; right: 0;">+</span> <!-- Icon to be toggled -->
            <span style="display: block; border-bottom: 1px solid rgb(0, 0, 0); margin-top: 5px;"></span>
        </h2>

        <form id="addressInputs" style="display: none;" method="post">

            <select name="tinh" id="tinh" required
                style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px; margin-bottom: 15px;">
                <option value="">Ch·ªçn T·ªânh/Th√†nh ph·ªë</option>
                <option value="TP H·ªì Ch√≠ Minh">TP H·ªì Ch√≠ Minh</option>
                <option value="H√† N·ªôi">H√† N·ªôi</option>
            </select>

            <select name="quan" id="quan" required
                style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px; margin-bottom: 15px;">
                <option value="">Ch·ªçn Qu·∫≠n/Huy·ªán</option>
                <option value="Qu·∫≠n 1">Qu·∫≠n 1</option>
                <option value="Qu·∫≠n 2">Qu·∫≠n 2</option>
                <option value="Qu·∫≠n 3">Qu·∫≠n 3</option>
                <option value="Qu·∫≠n 4">Qu·∫≠n 4</option>
                <option value="Qu·∫≠n 5">Qu·∫≠n 5</option>
                <option value="Qu·∫≠n 6">Qu·∫≠n 6</option>
                <option value="Qu·∫≠n 7">Qu·∫≠n 7</option>
                <option value="Qu·∫≠n 8">Qu·∫≠n 8</option>
                <option value="Qu·∫≠n 9">Qu·∫≠n 9</option>
                <option value="Qu·∫≠n 10">Qu·∫≠n 10</option>
                <option value="Qu·∫≠n 11">Qu·∫≠n 11</option>
                <option value="Qu·∫≠n 12">Qu·∫≠n 12</option>
                <option value="Qu·∫≠n B√¨nh Th·∫°nh">Qu·∫≠n
                    B√¨nh Th·∫°nh</option>
                <option value="Qu·∫≠n Ph√∫ Nhu·∫≠n">Qu·∫≠n Ph√∫
                    Nhu·∫≠n</option>
                <option value="Qu·∫≠n G√≤ V·∫•p">Qu·∫≠n G√≤ V·∫•p
                </option>
                <option value="Qu·∫≠n T√¢n B√¨nh">Qu·∫≠n T√¢n
                    B√¨nh</option>
                <option value="Qu·∫≠n T√¢n Ph√∫">Qu·∫≠n T√¢n Ph√∫
                </option>
                <option value="Qu·∫≠n Th·ªß ƒê·ª©c">Qu·∫≠n Th·ªß ƒê·ª©c
                </option>
                <option value="Huy·ªán B√¨nh Ch√°nh">Huy·ªán
                    B√¨nh Ch√°nh</option>
                <option value="Huy·ªán C·∫ßn Gi·ªù">Huy·ªán C·∫ßn
                    Gi·ªù</option>
                <option value="Huy·ªán C·ªß Chi">Huy·ªán C·ªß Chi
                </option>
                <option value="Huy·ªán H√≥c M√¥n">Huy·ªán H√≥c
                    M√¥n</option>
                <option value="Huy·ªán Nh√† B√®">Huy·ªán Nh√† B√®
                </option>
            </select>

            <input type="text" name="phuong" id="phuong" placeholder="Ph∆∞·ªùng/ X√£" required
                style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px; margin-bottom: 5px;">
            <p style="font-size: 14px; color: #777; margin-top: 2px;">V√≠ d·ª•: TƒÉng Nh∆°n Ph√∫ A</p>

            <input type="text" name="nha" id="nha" placeholder="S·ªë nh√†/ t√™n ƒë∆∞·ªùng" required
                style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px; margin-bottom: 5px;">
            <p style="font-size: 14px; color: #777; margin-top: 2px;">V√≠ d·ª•: 33 ƒë∆∞·ªùng L√™ Du·∫©n</p>

            <input type="text" name="ghichu" id="ghichu" placeholder="Ghi ch√∫"
                style="width: 100%; padding: 12px; border: 1px solid #000000; border-radius: 0px; font-size: 16px; margin-bottom: 5px;">
            <p style="font-size: 14px; color: #777; margin-top: 2px;">V√≠ d·ª•: T√™n t√≤a nh√†, t·∫ßng</p>

            <button class="button-27" type="submit" id="address-btn"
                style="background-color: #000; color: #fff;  width: 100%; display: flex; align-items: center; justify-content: center; border: none;"
                role="button">
                L∆∞u
            </button>

        </form>
    </div>
</div>
<div class="modal fade" id="alertModal" style="display: none;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content"
            style="position:relative; display: flex; align-items: center; justify-content: center;">
            <span class="closexxx"
                style="position:absolute; right:10px; top:5px; font-size: 30px; cursor: pointer; transition: color 0.3s;">&times;</span>
            <div
                style="background: #fff; padding: 40px; border-radius: 20px; width: 100%; height: auto; display: flex; flex-direction: column; justify-content: center;">
                <p id="alert-text"
                    style="margin-bottom:-20px; text-align: center; color: #333;font-size:20px;color:red">C√≥ l·ªói</p>

            </div>
            <button type="submit" class="button-27 closexxx"
                style="margin-bottom: 30px; background-color: #010101; color: #fff; padding: 14px; border-radius: 10px; border: none; cursor: pointer; width:170px; font-size: 16px;">
                X√°c nh·∫≠n
            </button>
        </div>
    </div>
</div>


<script>
    function toggleInputs() {
        const inputs = document.getElementById('addressInputs');
        const icon = document.getElementById('toggleIcon');

        if (inputs.style.display === 'none' || inputs.style.display === '') {
            inputs.style.display = 'block';
            icon.innerHTML = '-'; // Change icon to minus
        } else {
            inputs.style.display = 'none';
            icon.innerHTML = '+'; // Change icon back to plus
        }
    }
</script>


{{!-- Kiem tra thong tin --}}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById('info-form');
        const pwform = document.getElementById('pw-form');
        const pw = document.getElementById('password-btn');
        const alerttext = document.getElementById("alert-text")
        const closeButtons = document.querySelectorAll('.closexxx');
        closeButtons.forEach(async function (button) {
            button.onclick = function () {
                $('#alertModal').modal('hide');
            };
        });
        const token = localStorage.getItem("token") || "";
        if (!token) {
            alerttext.innerHTML = "Vui l√≤ng ƒëƒÉng nh·∫≠p!";
            $("#alertModal").modal("show");
            $("#alertModal").on("hidden.bs.modal", function () {
                window.location.href = "/account/login";
                return;
            });
        }
        pw.addEventListener("click", async function (e) {
            e.preventDefault();
            if (!checkpw()) {
                $('#alertModal').modal('show');
            } else {
                const newpw = document.getElementById("newPassword").value.trim();
                const oldpw = document.getElementById("oldPassword").value.trim();
                fetch("http://localhost:3001/password", {
                    method: "PUT",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ oldpw, newpw }),
                })
                    .then(async (response) => {
                        const data = await response.json();
                        if (data.message == "M·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c!") {
                            alerttext.innerHTML = data.message;
                            $("#alertModal").modal("show");
                        }
                        else if (data.message == "ƒê·ªïi th√†nh c√¥ng!") {
                            alerttext.innerHTML = "ƒê·ªïi th√†nh c√¥ng!<br>Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!";
                            $("#alertModal").modal("show");
                            $("#alertModal").on("hidden.bs.modal", function () {
                                localStorage.removeItem("token");
                                window.location.href = "/account/login";
                                return;
                            });
                        }
                        else {
                            alerttext.innerHTML = data.message;
                            $("#alertModal").modal("show");
                            $("#alertModal").on("hidden.bs.modal", function () {
                                window.location.href = "/account/login";
                                return;
                            });
                        }

                    })
                    .catch((error) => {
                        console.log("L·ªói k·∫øt n·ªëi ƒë·∫øn server:", error);
                        alert("Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. H√£y th·ª≠ l·∫°i sau!" + error);
                    });

            }

            function checkpw() {
                const oldpw = document.getElementById("oldPassword");
                const newpw = document.getElementById("newPassword");
                const conpw = document.getElementById("confirmPassword");
                if (oldpw.value == '') {
                    alerttext.innerHTML = "M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!";
                    return false;
                }
                else if (newpw.value == '' || conpw.value == '') {
                    alerttext.innerHTML = "M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!";
                    return false;
                }
                else if (newpw.value.length < 6) {
                    alerttext.innerHTML = "M·∫≠t kh·∫©u ph·∫£i l·ªõn h∆°n 5 k√≠ t·ª±!";
                    return false;
                }
                else if (newpw.value != conpw.value) {
                    alerttext.innerHTML = "M·∫≠t kh·∫©u kh√¥ng kh·ªõp!";
                    return false;
                }
                else if (newpw.value == oldpw.value) {
                    alerttext.innerHTML = "M·∫≠t kh·∫©u m·ªõi kh√¥ng ƒë∆∞·ª£c tr√πng v·ªõi m·∫≠t kh·∫©u c≈©!";
                    return false;
                }
                return true;
            }
        })
    })
</script>

{{!-- Thong tin khach hang --}}
<script>
    document.addEventListener("DOMContentLoaded", async (event) => {
        const token = localStorage.getItem("token") || "";
        const alerttext = document.getElementById("alert-text");
        const hovaten = document.getElementById("hovaten");
        const sdt = document.getElementById("sdt");
        const email = document.getElementById("email");
        const info = document.getElementById('info-button');
        if (!token) {
            alerttext.innerHTML = "Vui l√≤ng ƒëƒÉng nh·∫≠p!";
            $("#alertModal").modal("show");
            $("#alertModal").on("hidden.bs.modal", function () {
                window.location.href = "/account/login";
                return;
            });
        }
        fetch("http://localhost:3001", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json",
            }
        })
            .then(async (response) => {
                const data = await response.json();

                if (response.ok) {
                    hovaten.value = data.fullname || "";
                    sdt.value = data.phone || "";
                    email.value = data.email || "";
                } else {
                    alerttext.innerHTML = data.message || "X√°c th·ª±c th·∫•t b·∫°i!";
                    $("#alertModal").modal("show");
                }
            })
            .catch((error) => {
                console.error("Fetch error:", error);
            });

        info.addEventListener('click', async (e) => {
            e.preventDefault();
            const hovatenval = hovaten.value.trim();
            const emailval = email.value.trim();
            const sdtval = sdt.value.trim();
            if (hovatenval == "" || sdtval == "" || emailval == "") {
                alerttext.innerHTML = "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!";
                $("#alertModal").modal("show");
                return;
            }
            if (sdtval.length < 8) {
                alerttext.innerHTML = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá!";
                $("#alertModal").modal("show");
                return;
            }
            fetch("http://localhost:3001/", {
                method: "PATCH",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ fullname:hovatenval, email:emailval, phone:sdtval }),
            })
                .then(async (respone) => {
                    const data = await respone.json();
                    if (respone.ok) {
                        alerttext.innerHTML = data.message || "L∆∞u th√†nh c√¥ng!";
                        $("#alertModal").modal("show");
                    } else {
                        alerttext.innerHTML = data.message || "X√°c th·ª±c th·∫•t b·∫°i!";
                        $("#alertModal").modal("show");
                    }
                })
                .catch((error) => {
                    console.error("Fetch error:", error);
                });
        })
    });

</script>
{{!-- Lay dia chi khach hang --}}
<script>
    document.addEventListener("DOMContentLoaded", async (event) => {
        const token = localStorage.getItem("token") || "";
        const alerttext = document.getElementById("alert-text");
        const tinh = document.getElementById("tinh");
        const quan = document.getElementById("quan");
        const phuong = document.getElementById("phuong");
        const nha = document.getElementById("nha");
        const ghichu = document.getElementById("ghichu");

        fetch("http://localhost:3001/address", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json",
            },
        })
            .then(async (response) => {
                const data = await response.json();

                if (response.ok) {
                    tinh.value = data.tinh || "";
                    quan.value = data.quan || "";
                    phuong.value = data.phuong || "";
                    nha.value = data.nha || "";
                    ghichu.value = data.ghichu || "";
                } else {
                    console.log("L·ªói khi l·∫•y ƒë·ªãa ch·ªâ")
                }
            })
            .catch((error) => {
                console.error("Fetch error:", error);
            });
    });

</script>

{{!-- Them sua dia chi khach hang--}}
<script>
    document.addEventListener("DOMContentLoaded", (event) => {
        const token = localStorage.getItem("token") || "";
        const submit_btn = document.getElementById('address-btn');
        const alerttext = document.getElementById("alert-text");

        submit_btn.addEventListener("click", async (e) => {
            e.preventDefault();
            const tinh = document.getElementById("tinh").value;
            const quan = document.getElementById("quan").value;
            const phuong = document.getElementById("phuong").value.trim();
            const nha = document.getElementById("nha").value.trim();
            const ghichu = document.getElementById("ghichu").value.trim();
            if (tinh == "" || quan == "" || phuong == "" || nha == "" || ghichu == "") {
                alerttext.innerHTML = "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!";
                $("#alertModal").modal("show");
                return;
            }
            fetch("http://localhost:3001/address", {
                method: "PATCH",
                credentials: "include",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ tinh, quan, phuong, nha, ghichu }),
            })
                .then(async (response) => {
                    const data = await response.json();

                    if (response.ok) {
                        alerttext.innerHTML = data.message || "L∆∞u th√†nh c√¥ng!";
                        $("#alertModal").modal("show");
                    } else {
                        alerttext.innerHTML = data.message || "X√°c th·ª±c th·∫•t b·∫°i!";
                        $("#alertModal").modal("show");
                    }
                })
                .catch((error) => {
                    console.error("Fetch error:", error);
                });
        })
    })
</script>

{{!-- lay danh sach don hang --}}
<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const sortValue = urlParams.get("sort");
        const token = localStorage.getItem("token");

        try {
            const url = sortValue ? `http://localhost:3003/order?sort=${sortValue}` : `http://localhost:3003/order`
            const response = await fetch(url, {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${token}`,
                }
            });

            if (!response.ok) throw new Error("L·ªói khi t·∫£i ƒë∆°n h√†ng");

            const data = await response.json();
            const orders = data.orderItems || [];
            if (orders.length == 0) {
                document.getElementById("empty").style.display = "block";
            }

            const orderItemDiv = document.getElementById("order-item-div");
            orderItemDiv.innerHTML = ""; // X√≥a n·ªôi dung c≈©

            orders.forEach(order => {
                const div = document.createElement("div");
                div.style = "height: 250px; border: 1px solid #000; overflow: hidden; margin-bottom: 30px;";
                div.innerHTML = `
                <div class="row g-0">
                    <a href="/product/${order.product_id}" class="col-md-4 d-flex align-items-center justify-content-center">
                        <img src="${order.mainImg}" class="img-fluid" alt="..." style="width: 267px; aspect-ratio: 1/1; object-fit: cover;">
                    </a>
                    <div class="col-md-8">
                        <div class="card-body don-hang" style="height: 250px; padding: 20px; position: relative; background-color:white">
                            <h5 style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical;overflow: hidden;
                            text-overflow: ellipsis; white-space: normal; margin: 0;  text-align: left; font-size: 21px;
                            margin-bottom: 5px; margin-top: 5px; font-weight: 600;">
                                ${order.name}
                            </h5>
                            <div style="display: flex; justify-content: space-between;">
                                <p class="card-text" style="margin-top: 10px; text-align: center; font-size: 18px;">
                                        <span style="color: red;font-size: 18px;font-weight: 700;">${order.price.toLocaleString('vi-VN')}‚Ç´</span>
                                </p>
                                <p style="margin-top: 16px; font-weight: 100; font-family: 'Arial', sans-serif; font-size: 12px; font-style: italic;">
                                    <span class="created-at" data-date="${order.created_at}"></span>
                                </p>  
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="quantity-container" style="display: flex; justify-content: center; align-items: center; gap: 3px; margin-top: 10px; margin-right: 15px;">
                                    <button type="button" class="quantity-btn" style="width: 26px; height: 26px; padding: 0; font-size: 12px;" disabled>-</button>
                                    <div style="display: flex; align-items: center; justify-content: center; height: 26px;">
                                        <input type="number" name="soluong" value="${order.quantity}" min="1" max="10" readonly style="width: 30px; height: 26px; font-size: 12px; text-align: right; line-height: 26px; padding: 0;">
                                    </div>
                                    <button type="button" class="quantity-btn" disabled style="width: 26px; height: 26px; padding: 0; font-size: 12px;">+</button>
                                </div>
                                
                            </div>
                            <button class="madonhang statusButton" data-bs-toggle="modal" data-bs-target="#huyModal${order.order_item_id}" 
                                    style="background-color: #ff5722; color: #fff; margin-top: 30px; width: 170px; height: 40px; display: flex; align-items: center; justify-content: center; border: none;
                                     border-radius: 0; cursor: pointer; box-sizing: border-box; font-size: 16px;position: absolute;bottom: 30px; right: 30px;">
                                    <i class="bi bi-truck" style="margin-right: 8px; font-size: 20px;"></i> ${order.status}
                                </button>
                                <!-- Modal h·ªßy ƒë∆°n -->
                                <div class="modal fade" id="huyModal${order.order_item_id}" tabindex="-1" aria-labelledby="huyModalLabel${order.order_item_id}" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content" style="position: relative; display: flex; align-items: center; justify-content: center;">
                                            <span class="close-modal" data-product-id="${order.order_item_id}" 
                                                style="position: absolute; right: 10px; top: 5px; font-size: 30px; cursor: pointer; transition: color 0.3s;">
                                                &times;
                                            </span>
                                            <div style="background: #fff; padding: 40px; border-radius: 20px; width: 100%; height: auto; display: flex; flex-direction: column; justify-content: center;">
                                                <h1 style="margin-bottom: 20px; text-align: center; color: #000000;font-size: 33px;font-weight: 500;">B·∫°n c√≥ ch·∫Øc l√† mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?</h1>
                                                <div style="display: flex; justify-content: space-between; gap: 10px;">
                                                    <button type="button" class="button-27 close-modal" data-product-id="${order.order_item_id}" 
                                                        style="margin-top: 15px; background-color: #000000; color: #fff; padding: 14px; border-radius: 10px; border: none; cursor: pointer; width: 100%; font-size: 16px;">
                                                        H·ªßy
                                                    </button>
                                                    <button type="button" class="button-27 confirm-cancel" data-product-id="${order.order_item_id}" onclick="huy(${order.order_item_id})"
                                                        style="margin-top: 15px; background-color: #fd1818; color: #fff; padding: 14px; border-radius: 10px; border: none; cursor: pointer; width: 100%; font-size: 16px;">
                                                        X√°c nh·∫≠n
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                        </div>
                    </div>
                </div>
            `;
                orderItemDiv.appendChild(div);
            });
            updateOrderStatusButtons()

        } catch (error) {
            console.error("L·ªói:", error);
        }
        document.querySelectorAll(".created-at").forEach(element => {
            const rawDate = element.getAttribute("data-date");

            if (rawDate) {
                const date = new Date(rawDate);
                const formattedDate = date.toLocaleString("en-GB", {
                    day: "2-digit",
                    month: "2-digit",
                    year: "numeric",
                    hour: "2-digit",
                    minute: "2-digit",

                }).replace(",", "");

                element.textContent = formattedDate;
            }
        });
    });

</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // L·∫Øng nghe s·ª± ki·ªán click tr√™n t·∫•t c·∫£ c√°c n√∫t c√≥ id="closex"
        document.querySelectorAll("#closex").forEach(button => {
            button.addEventListener("click", () => {
                $("#huyModal").modal("hide");
            });
        });
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function () {
                const sort = this.value;
                document.getElementById('sortValue').value = sort;

                // Submit the form to send both 'text' and 'sort' parameters
                document.getElementById('sort-form').submit();
            });
        });
    });
</script>

<script>
    document.addEventListener("click", function (event) {
        if (event.target.classList.contains("close-modal")) {
            let product_id = event.target.getAttribute("data-product-id");
            let modalId = `#huyModal${product_id}`;

            $(modalId).modal("hide");
        }
    });
    function updateOrderStatusButtons() {
        document.querySelectorAll(".statusButton").forEach(button => {
            let status = button.textContent.trim().toLowerCase(); // Chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng ƒë·ªÉ tr√°nh l·ªói
            if (status === "da-giao") {
                button.innerHTML = `<i class="bi bi-check-circle" style="margin-right: 8px; font-size: 20px;"></i> ƒê√£ giao`;
                button.style.backgroundColor = "#4CAF50"; // Xanh l√°
                button.style.cursor = "default";
                button.removeAttribute("data-bs-toggle"); // Kh√¥ng m·ªü modal
                button.removeAttribute("data-bs-target");
                button.onclick = null; // X√≥a s·ª± ki·ªán onclick
            } else if (status === "dang-xu-ly") {
                button.innerHTML = `<i class="bi bi-hourglass-split" style="margin-right: 8px; font-size: 20px;"></i> Ch·ªù x√°c nh·∫≠n`;
                button.style.backgroundColor = "#FF9800"; // Cam
                // Hi·ªáu ·ª©ng hover chuy·ªÉn th√†nh "H·ªßy ƒê∆°n H√†ng"
                button.addEventListener("mouseenter", function () {
                    this.innerHTML = `<i class="bi bi-x-circle" style="margin-right: 8px; font-size: 20px;"></i> H·ªßy ƒê∆°n H√†ng`;
                    this.style.backgroundColor = "#f44336"; // ƒê·ªè
                });
                button.addEventListener("mouseleave", function () {
                    this.innerHTML = `<i class="bi bi-hourglass-split" style="margin-right: 8px; font-size: 20px;"></i> Ch·ªù x√°c nh·∫≠n`;
                    this.style.backgroundColor = "#FF9800"; // Cam
                })
            }
            else if (status === "dang-giao") {
                button.innerHTML = `<i class="bi bi-truck" style="margin-right: 8px; font-size: 20px;"></i> ƒêang giao`;
                button.style.backgroundColor = "#4CAF50"; // Cam
                button.style.cursor = "default";
                button.removeAttribute("data-bs-toggle"); // Kh√¥ng m·ªü modal
                button.removeAttribute("data-bs-target");
                button.onclick = null; // X√≥a s·ª± ki·ªán onclick
            }
            else if (status === "da-huy") {
                button.innerHTML = `<i class="bi bi-x-circle" style="margin-right: 8px; font-size: 20px;"></i> ƒê√£ hu·ª∑`;
                button.style.backgroundColor = "#f44336"; // ƒê·ªè
                button.style.cursor = "default";
                button.removeAttribute("data-bs-toggle"); // Kh√¥ng m·ªü modal
                button.removeAttribute("data-bs-target");
                button.onclick = null; // X√≥a s·ª± ki·ªán onclick
            }
        });
    }

    // H√†m x·ª≠ l√Ω h·ªßy ƒë∆°n h√†ng
    async function huy(order_item_id) {
        console.log(`üîπ G·ªçi API h·ªßy ƒë∆°n h√†ng v·ªõi ID: ${order_item_id}`);

        const token = localStorage.getItem("token");
        if (!token) {
            console.error("Kh√¥ng t√¨m th·∫•y token!");
            return;
        }

        try {
            const response = await fetch(`http://localhost:3003/order/status/${order_item_id}`, {
                method: "PATCH",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ status: "da-huy" })
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error("API tr·∫£ v·ªÅ l·ªói:", errorData);
                document.getElementById("alert-text").innerHTML = errorData.message || "L·ªói khi h·ªßy ƒë∆°n h√†ng!";
                $("#alertModal").modal("show");
                return;
            }

            const data = await response.json();
            console.log("‚úÖ API tr·∫£ v·ªÅ:", data);

            document.getElementById("alert-text").innerHTML =  "H·ªßy ƒë∆°n h√†ng th√†nh c√¥ng!";
            $("#alertModal").modal("show");

            $("#alertModal").on("hidden.bs.modal", function () {
                window.location.reload();
            });

        } catch (error) {
            console.error("‚ùå L·ªói khi g·ªçi API:", error);
            document.getElementById("alert-text").innerHTML = "L·ªói k·∫øt n·ªëi ƒë·∫øn server!";
            $("#alertModal").modal("show");
        }
    }

</script>